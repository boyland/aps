with "tiny";

module USE_OBJECT[T :: var TINY[]] extends T
begin
  phylum Object;
  constructor object(x : Integer) : Object;

  attribute Object.field : Integer := 42;

  type Obj := remote Object;

  attribute Wood.obj : Obj;
  attribute Wood.num : Integer;
  attribute Wood.isBranch : Boolean := false;
  pragma inherited(obj);
  pragma synthesized(num, isBranch);

  attribute Root.total : Integer;
  pragma synthesized(total);

  match ?p=root(?w) begin
    o : Object := object(42);
    w.obj := o;
    p.total := w.num;
    if w.isBranch then
       o.field := 7;
    endif;
  end;

  match ?self=branch(?w1,?w2) begin
    w1.obj := self.obj;
    w2.obj := self.obj;
    self.isBranch := true;
    self.num := w1.num + w2.num;
  end;

  match ?self=leaf(?n) begin
    self.num := n + self.obj.field;
  end;
end;
